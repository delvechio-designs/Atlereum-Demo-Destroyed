// notifications.js

// Create a WebSocket connection
const socket = new WebSocket(
  `${window.location.protocol === 'https:' ? 'wss://' : 'ws://'}${window.location.host}/ws/notifications/`
);

// Event listener for when the connection is opened
socket.onopen = function() {
  console.log('WebSocket connection established');

};

// Event listener for receiving messages
// notifications.js
socket.onmessage = function(event) {
  console.log('Message received:', event.data);
  let data = JSON.parse(event.data);
  const notification = data.notification;

  if (notification) {
      const notificationList = document.getElementById('notificationList');

      // Remove the "No Notifications" message if it exists
      const noNotification = document.getElementById('noNotification');
      if (noNotification) {
          noNotification.remove();
      }

      // Append the new notification to the list
      notificationList.innerHTML += `<div>${notification.title}: ${notification.description}</div>`;
      
      const alertCounter = document.getElementById('alertCounter');
      alertCounter.textContent = parseInt(alertCounter.textContent) + 1;
  }
};


// Event listener for when the connection is closed
socket.onclose = function(event) {
  console.log('WebSocket connection closed', event);
};

// Event listener for WebSocket errors
socket.onerror = function(error) {
  console.error('WebSocket Error:', error);
};
