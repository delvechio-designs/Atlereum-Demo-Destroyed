# utils.py
from .models import Proposal
from notifications.models import Notification

def update_proposal_status(proposal, new_status):
    old_status = proposal.status  # Save the old status for notification
    proposal.status = new_status  # Update the status
    proposal.save()  # Save the proposal to the database

    # Create and save the notification
    create_notification(proposal.user, proposal.title, old_status, new_status)

def create_notification(user, proposal_title, old_status, new_status):
    description = f'The proposal "{proposal_title}" status changed from "{old_status}" to "{new_status}".'
    Notification.objects.create(user=user, title='Proposal Status Changed', description=description)
