from django.shortcuts import render, redirect
from django.urls import reverse_lazy
from django.contrib import messages
from django.views.generic import CreateView, ListView, UpdateView

from .forms import FindingForm
from .models import Finding

# Create your views here.

class FindingListView(ListView):
    model = Finding
    template_name = "dashboard/findings/list.html"

    def get_queryset(self):
        queryset = super().get_queryset()
        return queryset.filter(user=self.request.user)

class FindingCreateView(CreateView):
    model = Finding
    success_url = reverse_lazy("findings:FindingListView")
    template_name = "dashboard/findings/create.html"
    form_class = FindingForm

    def form_valid(self, form):
        asset = form.save(commit=False)
        asset.user = self.request.user
        asset.save()
        messages.success(self.request, "Finding created successfully")
        return redirect(self.success_url)

class FindingUpdateView(UpdateView):
    model = Finding
    success_url = reverse_lazy("findings:FindingListView")
    template_name = "dashboard/findings/update.html"
    form_class = FindingForm

    def get_success_url(self):
        messages.success(self.request, "Finding updated successfully")
        return super().get_success_url()