from django.contrib import admin
from .models import Notification,Message
from notifications.utils import send_notification  # Ensure this path is correct
from django.contrib.auth import get_user_model

User = get_user_model()
@admin.register(Notification)
class NotificationAdmin(admin.ModelAdmin):
    list_display = ('title', 'user', 'created_at', 'read')

    def send_notification_action(self, request, queryset):
        for notification in queryset:
            # Only send the notification to the specific user
            send_notification(
                notification.user.id,
                {
                    'title': notification.title,
                    'description': notification.description,
                    'created_at': notification.created_at.strftime("%Y-%m-%d %H:%M:%S"),
                }
            )
        self.message_user(request, "Notifications sent successfully.")

    send_notification_action.short_description = "Send notification to selected users"
    actions = [send_notification_action]





@admin.register(Message)
class MessageAdmin(admin.ModelAdmin):
    list_display = ('sender', 'receiver', 'content', 'created_at')

    def send_notification_action(self, request, queryset):
        for message in queryset:  # Change 'notification' to 'message'
            # Send notification to the receiver of the message
            send_notification(
                message.receiver.id,  # Use message.receiver.id instead of notification.user.id
                {
                    'title': f"New message from {message.sender.username}",  # Customize title as needed
                    'description': message.content,
                    'created_at': message.created_at.strftime("%Y-%m-%d %H:%M:%S"),
                }
            )
        self.message_user(request, "Notifications sent successfully.")

    send_notification_action.short_description = "Send notification for selected messages"
    actions = [send_notification_action]
